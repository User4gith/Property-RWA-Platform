<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增资产 - PropertyChain RWA平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .step-active {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
        }
        .step-completed {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        .step-pending {
            background: #F3F4F6;
            color: #6B7280;
        }
        .upload-area {
            border: 2px dashed #D1D5DB;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        .upload-area.dragover {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        .file-preview {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
        }
        .progress-bar {
            background: linear-gradient(90deg, #3B82F6, #1D4ED8);
        }
        .form-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            padding: 24px;
            margin-bottom: 24px;
        }
        .input-focus:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .checkbox-custom {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #D1D5DB;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }
        .checkbox-custom:checked {
            background: #3B82F6;
            border-color: #3B82F6;
        }
        .checkbox-custom:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .validation-error {
            border-color: #EF4444 !important;
            background-color: #FEF2F2;
        }
        .validation-success {
            border-color: #10B981 !important;
            background-color: #F0FDF4;
        }
        .preview-card {
            background: linear-gradient(135deg, #F8FAFC, #F1F5F9);
            border: 1px solid #CBD5E1;
        }
        .step-nav:hover {
            transform: scale(1.1);
        }
        .step-nav.step-completed {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        .photo-upload-main {
            min-height: 200px;
        }
        .photo-upload-gallery {
            min-height: 120px;
        }
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 顶部导航栏 -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center">
                            <i class="fas fa-building text-white text-lg"></i>
                        </div>
                        <div>
                            <span class="text-xl font-bold text-gray-900">PropertyChain</span>
                            <div class="text-xs text-gray-500">资产管理平台</div>
                        </div>
                    </div>
                </div>

                <!-- 中间导航 -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="asset-dashboard.html" class="text-gray-600 hover:text-gray-900 pb-4">仪表盘</a>
                    <a href="asset-list.html" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-4">资产管理</a>
                    <a href="asset-tokenization.html" class="text-gray-600 hover:text-gray-900 pb-4">代币化</a>
                    <!-- <a href="#" class="text-gray-600 hover:text-gray-900 pb-4">文档管理</a>
                    <a href="#" class="text-gray-600 hover:text-gray-900 pb-4">收益报告</a> -->
                </div>

                <div class="flex items-center space-x-4">
                    <!-- 通知 -->
                    <button class="relative p-2 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bell text-lg"></i>
                        <span class="absolute -top-1 -right-1 h-5 w-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                    </button>
                    
                    <!-- 用户信息 -->
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <div class="text-sm font-medium text-gray-900">XX地产</div>
                            <div class="text-xs text-gray-500">项目方</div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?w=40&h=40&fit=crop" 
                             alt="公司logo" class="w-10 h-10 rounded-full border-2 border-gray-200">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- 面包屑导航 -->
        <nav class="mb-6">
            <ol class="flex items-center space-x-2 text-sm">
                <li><a href="asset-dashboard.html" class="text-blue-600 hover:text-blue-800">仪表盘</a></li>
                <li><i class="fas fa-chevron-right text-gray-400"></i></li>
                <li><a href="asset-list.html" class="text-blue-600 hover:text-blue-800">资产管理</a></li>
                <li><i class="fas fa-chevron-right text-gray-400"></i></li>
                <li class="text-gray-500">新增资产</li>
            </ol>
        </nav>

        <!-- 页面标题 -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">新增房地产资产</h1>
                <p class="text-gray-600 mt-2">录入您的房地产资产信息，提交平台审核</p>
            </div>
            <div class="flex space-x-3">
                <button onclick="saveDraft()" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fas fa-save mr-2"></i>保存草稿
                </button>
                <button onclick="previewAsset()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-eye mr-2"></i>预览资产
                </button>
            </div>
        </div>

        <!-- 流程提示 -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <div class="flex items-center space-x-3">
                <i class="fas fa-info-circle text-blue-600 text-lg"></i>
                <div>
                    <p class="text-sm text-blue-800">
                        <strong>资产录入流程：</strong>
                        1. 填写资产基本信息 → 
                        2. 上传法律文件 → 
                        3. 提供财务数据 → 
                        4. 补充物理特征 → 
                        5. 提交审核
                    </p>
                    <p class="text-sm text-blue-700 mt-1">
                        审核通过后，您可以在<a href="asset-tokenization.html" class="underline font-medium">代币化管理</a>页面对资产进行代币化设置
                    </p>
                </div>
            </div>
        </div>

        <!-- 进度指示器和步骤导航 -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">资产创建进度</h2>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">步骤 <span id="currentStep">1</span> / 5</span>
                    <button onclick="toggleStepPreview()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-list mr-1"></i>查看所有步骤
                    </button>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="goToStep(1)" class="step-nav step-active flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform">1</button>
                <div class="flex-1 h-2 bg-gray-200 rounded-full">
                    <div id="progressBar" class="progress-bar h-2 rounded-full transition-all duration-500" style="width: 20%"></div>
                </div>
                <button onclick="goToStep(2)" class="step-nav step-pending flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform">2</button>
                <div class="flex-1 h-2 bg-gray-200 rounded-full"></div>
                <button onclick="goToStep(3)" class="step-nav step-pending flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform">3</button>
                <div class="flex-1 h-2 bg-gray-200 rounded-full"></div>
                <button onclick="goToStep(4)" class="step-nav step-pending flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform">4</button>
                <div class="flex-1 h-2 bg-gray-200 rounded-full"></div>
                <button onclick="goToStep(5)" class="step-nav step-pending flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform">5</button>
            </div>
            <div class="flex justify-between mt-2 text-xs text-gray-600">
                <span class="cursor-pointer hover:text-blue-600" onclick="goToStep(1)">基本信息</span>
                <span class="cursor-pointer hover:text-blue-600" onclick="goToStep(2)">法律文件</span>
                <span class="cursor-pointer hover:text-blue-600" onclick="goToStep(3)">财务信息</span>
                <span class="cursor-pointer hover:text-blue-600" onclick="goToStep(4)">物理特征</span>
                <span class="cursor-pointer hover:text-blue-600" onclick="goToStep(5)">审核提交</span>
            </div>
        </div>

        <!-- 步骤内容预览 -->
        <div id="stepPreview" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 hidden">
            <h3 class="font-semibold text-blue-900 mb-3">各步骤填写内容预览</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                <div class="bg-white p-3 rounded-lg cursor-pointer hover:bg-blue-50" onclick="goToStep(1)">
                    <h4 class="font-medium text-gray-900 mb-2">1. 基本信息</h4>
                    <ul class="text-gray-600 space-y-1">
                        <li>• 资产名称和类型</li>
                        <li>• 详细地址位置</li>
                        <li>• 建筑面积信息</li>
                        <li>• 资产主要照片</li>
                    </ul>
                </div>
                <div class="bg-white p-3 rounded-lg cursor-pointer hover:bg-blue-50" onclick="goToStep(2)">
                    <h4 class="font-medium text-gray-900 mb-2">2. 法律文件</h4>
                    <ul class="text-gray-600 space-y-1">
                        <li>• 产权证书</li>
                        <li>• 土地使用证</li>
                        <li>• SPV治理结构</li>
                        <li>• 托管和保险管理</li>
                    </ul>
                </div>
                <div class="bg-white p-3 rounded-lg cursor-pointer hover:bg-blue-50" onclick="goToStep(3)">
                    <h4 class="font-medium text-gray-900 mb-2">3. 财务信息</h4>
                    <ul class="text-gray-600 space-y-1">
                        <li>• 资产估值和评估</li>
                        <li>• 租金收入数据</li>
                        <li>• 运营成本分析</li>
                        <li>• 市场分析数据</li>
                    </ul>
                </div>
                <div class="bg-white p-3 rounded-lg cursor-pointer hover:bg-blue-50" onclick="goToStep(4)">
                    <h4 class="font-medium text-gray-900 mb-2">4. 物理特征</h4>
                    <ul class="text-gray-600 space-y-1">
                        <li>• 建筑年份层数</li>
                        <li>• 设施配套情况</li>
                        <li>• 建筑结构等级</li>
                        <li>• 详细建筑照片</li>
                    </ul>
                </div>
                <div class="bg-white p-3 rounded-lg cursor-pointer hover:bg-blue-50" onclick="goToStep(5)">
                    <h4 class="font-medium text-gray-900 mb-2">5. 审核提交</h4>
                    <ul class="text-gray-600 space-y-1">
                        <li>• 风险评估合规</li>
                        <li>• 信息确认检查</li>
                        <li>• 合规声明同意</li>
                        <li>• 提交审核申请</li>
                    </ul>
                </div>
            </div>
        </div>

        <form id="assetForm" class="space-y-8">
            <!-- 步骤1: 基本信息 -->
            <div id="step1" class="step-content">
                <div class="form-section">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-info-circle text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">基本资产信息</h3>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                资产名称 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="assetName" name="assetName" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：华润大厦A座">
                            <p class="text-xs text-gray-500 mt-1">资产的官方名称或项目名称</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                资产类型 <span class="text-red-500">*</span>
                            </label>
                            <select id="assetType" name="assetType" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">请选择资产类型</option>
                                <option value="office">写字楼</option>
                                <option value="retail">零售商业</option>
                                <option value="residential">住宅</option>
                                <option value="warehouse">仓储物流</option>
                                <option value="hotel">酒店</option>
                                <option value="industrial">工业</option>
                                <option value="mixed">综合体</option>
                                <option value="other">其他</option>
                            </select>
                        </div>

                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                详细地址 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="assetAddress" name="assetAddress" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：中国上海市浦东新区陆家嘴环路1000号">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                城市 <span class="text-red-500">*</span>
                            </label>
                            <select id="city" name="city" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">请选择城市</option>
                                <option value="shanghai">上海</option>
                                <option value="beijing">北京</option>
                                <option value="shenzhen">深圳</option>
                                <option value="guangzhou">广州</option>
                                <option value="hangzhou">杭州</option>
                                <option value="nanjing">南京</option>
                                <option value="chengdu">成都</option>
                                <option value="wuhan">武汉</option>
                                <option value="other">其他</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                邮政编码
                            </label>
                            <input type="text" id="zipCode" name="zipCode"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：200120">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建筑面积 (㎡) <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="buildingArea" name="buildingArea" required min="1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：25000">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                可租赁面积 (㎡)
                            </label>
                            <input type="number" id="rentableArea" name="rentableArea" min="1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：22000">
                        </div>

                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                资产描述
                            </label>
                            <textarea id="assetDescription" name="assetDescription" rows="4"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                      placeholder="请详细描述资产的特点、位置优势、周边配套等信息..."></textarea>
                        </div>
                    </div>

                    <!-- 主要资产照片上传 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">主要资产照片 <span class="text-red-500">*</span></h4>
                        <p class="text-sm text-gray-600 mb-4">请上传能够展示资产整体外观和重要特征的照片，这些照片将在资产详情页面展示给投资者</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- 主图上传 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">资产主图（封面）</label>
                                <div class="upload-area text-center p-8 rounded-lg cursor-pointer" onclick="document.getElementById('mainPhoto').click()">
                                    <i class="fas fa-camera text-5xl text-gray-400 mb-4"></i>
                                    <p class="text-lg font-medium text-gray-600 mb-2">点击上传主图</p>
                                    <p class="text-sm text-gray-500">这将作为资产的封面照片</p>
                                    <p class="text-xs text-gray-500 mt-2">支持 JPG, PNG 格式，建议尺寸 1200x800，最大5MB</p>
                                </div>
                                <input type="file" id="mainPhoto" name="mainPhoto" accept=".jpg,.png,.jpeg" class="hidden" onchange="handleMainPhotoUpload(this)">
                                <div id="mainPhotoPreview" class="file-preview mt-3 p-4 rounded-lg hidden">
                                    <div id="mainPhotoDisplay" class="relative">
                                        <!-- 主图预览将在这里显示 -->
                                    </div>
                                </div>
                            </div>

                            <!-- 更多照片上传 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">资产相册（2-10张）</label>
                                <div class="upload-area text-center p-8 rounded-lg cursor-pointer" onclick="document.getElementById('assetGallery').click()">
                                    <i class="fas fa-images text-5xl text-gray-400 mb-4"></i>
                                    <p class="text-lg font-medium text-gray-600 mb-2">上传资产相册</p>
                                    <p class="text-sm text-gray-500">多角度展示资产特色</p>
                                    <p class="text-xs text-gray-500 mt-2">支持 JPG, PNG 格式，每张最大5MB</p>
                                </div>
                                <input type="file" id="assetGallery" name="assetGallery" accept=".jpg,.png,.jpeg" multiple class="hidden" onchange="handleGalleryUpload(this)">
                                <div id="assetGalleryPreview" class="mt-3">
                                    <!-- 相册预览将在这里显示 -->
                                </div>
                            </div>
                        </div>

                        <!-- 照片要求说明 -->
                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mt-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-lightbulb text-blue-600 mt-1"></i>
                                <div>
                                    <h5 class="font-semibold text-blue-800 mb-2">照片拍摄建议</h5>
                                    <ul class="text-sm text-blue-700 space-y-1">
                                        <li>• <strong>主图：</strong>建筑正面全景，展示整体外观和周边环境</li>
                                        <li>• <strong>相册：</strong>入口大堂、电梯厅、典型楼层、停车场、周边配套等</li>
                                        <li>• <strong>光线：</strong>选择光线充足的时间拍摄，避免逆光和过暗</li>
                                        <li>• <strong>角度：</strong>多角度拍摄，突出建筑特色和地理位置优势</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            可随时切换到其他步骤继续填写
                        </div>
                        <button type="button" onclick="nextStep()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            下一步：法律文件 <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 步骤2: 法律文件（保持不变） -->
            <div id="step2" class="step-content hidden">
                <div class="form-section">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-contract text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">法律文件上传</h3>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 产权证书 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                产权证书 <span class="text-red-500">*</span>
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('propertyDeed').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="propertyDeed" name="propertyDeed" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'propertyDeedPreview')">
                            <div id="propertyDeedPreview" class="file-preview mt-2 p-3 rounded-lg hidden">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-file-pdf text-red-500"></i>
                                        <span class="text-sm text-gray-700"></span>
                                    </div>
                                    <button type="button" onclick="removeFile(this)" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 土地使用证 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                土地使用证 <span class="text-red-500">*</span>
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('landUseRight').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="landUseRight" name="landUseRight" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'landUseRightPreview')">
                            <div id="landUseRightPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>

                        <!-- 建设工程规划许可证 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建设工程规划许可证
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('constructionPermit').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="constructionPermit" name="constructionPermit" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'constructionPermitPreview')">
                            <div id="constructionPermitPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>

                        <!-- 消防验收证明 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                消防验收证明
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('fireApproval').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="fireApproval" name="fireApproval" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'fireApprovalPreview')">
                            <div id="fireApprovalPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>

                        <!-- 环评报告 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                环评报告
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('envReport').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="envReport" name="envReport" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'envReportPreview')">
                            <div id="envReportPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>

                        <!-- 其他法律文件 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                其他法律文件
                            </label>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('otherLegalDocs').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">点击上传或拖拽文件至此</p>
                                <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式，最大10MB</p>
                            </div>
                            <input type="file" id="otherLegalDocs" name="otherLegalDocs" accept=".pdf,.jpg,.png" multiple class="hidden" onchange="handleFileUpload(this, 'otherLegalDocsPreview')">
                            <div id="otherLegalDocsPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>
                    </div>

                    <!-- SPV治理结构 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">SPV治理结构</h4>
                        <p class="text-sm text-gray-600 mb-4">特殊目的载体(SPV)的设立和治理文件</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- SPV基本信息 -->
                            <div class="lg:col-span-2">
                                <h5 class="font-semibold text-gray-900 mb-3">SPV基本信息</h5>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            SPV公司名称 <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="spvName" name="spvName" required
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：万科国际中心资产管理有限公司">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            注册地司法管辖区 <span class="text-red-500">*</span>
                                        </label>
                                        <select id="spvJurisdiction" name="spvJurisdiction" required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                            <option value="">请选择司法管辖区</option>
                                            <option value="hong_kong">中国香港</option>
                                            <option value="singapore">新加坡</option>
                                            <option value="bvi">英属维尔京群岛</option>
                                            <option value="cayman">开曼群岛</option>
                                            <option value="delaware">美国特拉华州</option>
                                            <option value="mainland_china">中国大陆</option>
                                            <option value="other">其他</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            公司注册号
                                        </label>
                                        <input type="text" id="spvRegistrationNumber" name="spvRegistrationNumber"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：HK2024001234567">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            注册日期
                                        </label>
                                        <input type="date" id="spvRegistrationDate" name="spvRegistrationDate"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                    </div>
                                </div>
                            </div>

                            <!-- SPV注册文件 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    SPV注册文件 <span class="text-red-500">*</span>
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('spvRegistrationDocs').click()">
                                    <i class="fas fa-building text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传SPV注册证书</p>
                                    <p class="text-xs text-gray-500 mt-1">包括公司注册证书、章程等</p>
                                </div>
                                <input type="file" id="spvRegistrationDocs" name="spvRegistrationDocs" accept=".pdf,.jpg,.png" multiple class="hidden" onchange="handleFileUpload(this, 'spvRegistrationDocsPreview')">
                                <div id="spvRegistrationDocsPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>

                            <!-- 股权结构图 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    股权结构图 <span class="text-red-500">*</span>
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('equityStructure').click()">
                                    <i class="fas fa-sitemap text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传股权结构图</p>
                                    <p class="text-xs text-gray-500 mt-1">显示所有股东及其持股比例</p>
                                </div>
                                <input type="file" id="equityStructure" name="equityStructure" accept=".pdf,.jpg,.png" class="hidden" onchange="handleFileUpload(this, 'equityStructurePreview')">
                                <div id="equityStructurePreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>

                        <!-- 股东信息 -->
                        <div class="mt-6">
                            <h5 class="font-semibold text-gray-900 mb-3">主要股东信息</h5>
                            <div id="shareholdersList" class="space-y-4">
                                <!-- 股东1 -->
                                <div class="shareholder-info border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h6 class="font-medium text-gray-900">股东 #1</h6>
                                        <button type="button" onclick="removeShareholder(this)" class="text-red-500 hover:text-red-700 text-sm">
                                            <i class="fas fa-trash"></i> 删除
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">股东名称/姓名</label>
                                            <input type="text" name="shareholderName[]" required
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：万科企业股份有限公司">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">股东类型</label>
                                            <select name="shareholderType[]" 
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                                <option value="corporate">企业法人</option>
                                                <option value="individual">自然人</option>
                                                <option value="institution">机构投资者</option>
                                                <option value="fund">基金</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">持股比例 (%)</label>
                                            <input type="number" name="shareholderPercentage[]" min="0" max="100" step="0.01" required
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：100.00" onchange="calculateTotalShares()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">投票权比例 (%)</label>
                                            <input type="number" name="votingRights[]" min="0" max="100" step="0.01"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：100.00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" onclick="addShareholder()" class="mt-3 px-4 py-2 border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-50">
                                <i class="fas fa-plus mr-2"></i>添加股东
                            </button>
                            
                            <!-- 持股比例汇总 -->
                            <div class="bg-blue-50 p-4 rounded-lg mt-4">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-blue-900">总持股比例：</span>
                                    <span id="totalShares" class="text-lg font-bold text-blue-700">0%</span>
                                </div>
                                <p class="text-xs text-blue-600 mt-1" id="sharesValidation">请确保总持股比例为100%</p>
                            </div>
                        </div>

                        <!-- 治理结构 -->
                        <div class="mt-6">
                            <h5 class="font-semibold text-gray-900 mb-3">治理结构</h5>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        董事会主席
                                    </label>
                                    <input type="text" id="boardChairman" name="boardChairman"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                           placeholder="例：王石">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        法定代表人
                                    </label>
                                    <input type="text" id="legalRepresentative" name="legalRepresentative"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                           placeholder="例：郁亮">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        独立董事数量
                                    </label>
                                    <input type="number" id="independentDirectors" name="independentDirectors" min="0"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                           placeholder="例：3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        审计委员会设立
                                    </label>
                                    <select id="auditCommittee" name="auditCommittee"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择</option>
                                        <option value="yes">已设立</option>
                                        <option value="no">未设立</option>
                                        <option value="planned">计划设立</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 合规牌照 -->
                        <div class="mt-6">
                            <h5 class="font-semibold text-gray-900 mb-3">合规牌照和资质</h5>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="mas_singapore" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">新加坡MAS牌照</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="sfc_hongkong" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">香港SFC牌照</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="sec_usa" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">美国SEC注册</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="csrc_china" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">中国证监会备案</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="pboc_china" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">央行金融许可证</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="licenses" value="other" class="checkbox-custom">
                                    <span class="text-sm text-gray-700">其他资质</span>
                                </label>
                            </div>
                            
                            <!-- 牌照文件上传 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    牌照和资质文件
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('licenseDocs').click()">
                                    <i class="fas fa-certificate text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传相关牌照和资质证书</p>
                                    <p class="text-xs text-gray-500 mt-1">支持 PDF, JPG, PNG 格式</p>
                                </div>
                                <input type="file" id="licenseDocs" name="licenseDocs" accept=".pdf,.jpg,.png" multiple class="hidden" onchange="handleFileUpload(this, 'licenseDocsPreview')">
                                <div id="licenseDocsPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>

                        <!-- SPV合规提示 -->
                        <div class="bg-purple-50 border border-purple-200 p-4 rounded-lg mt-6">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-gavel text-purple-600 mt-1"></i>
                                <div>
                                    <h5 class="font-semibold text-purple-800 mb-2">SPV设立合规要求</h5>
                                    <ul class="text-sm text-purple-700 space-y-1">
                                        <li>• SPV必须在认可的司法管辖区注册并符合当地法规</li>
                                        <li>• 股权结构必须清晰透明，支持代币持有人的权益保护</li>
                                        <li>• 需要建立独立的治理结构，包括独立董事和审计委员会</li>
                                        <li>• 必须获得目标市场的相关金融牌照或监管备案</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 托管和保险管理 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">托管和保险管理</h4>
                        <p class="text-sm text-gray-600 mb-4">确保物理资产安全和专业管理</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- 物业管理公司 -->
                            <div class="lg:col-span-2">
                                <h5 class="font-semibold text-gray-900 mb-3">物业管理公司</h5>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            管理公司名称 <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="managementCompany" name="managementCompany" required
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：万科物业服务股份有限公司">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            管理资质等级
                                        </label>
                                        <select id="managementGrade" name="managementGrade"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                            <option value="">请选择资质等级</option>
                                            <option value="national_a">国家一级资质</option>
                                            <option value="national_b">国家二级资质</option>
                                            <option value="national_c">国家三级资质</option>
                                            <option value="local_a">地方一级资质</option>
                                            <option value="other">其他资质</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            合同开始日期
                                        </label>
                                        <input type="date" id="managementStartDate" name="managementStartDate"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            合同到期日期
                                        </label>
                                        <input type="date" id="managementEndDate" name="managementEndDate"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                    </div>
                                </div>
                                
                                <!-- 管理合同上传 -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        物业管理合同 <span class="text-red-500">*</span>
                                    </label>
                                    <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('managementContract').click()">
                                        <i class="fas fa-file-contract text-4xl text-gray-400 mb-3"></i>
                                        <p class="text-sm text-gray-600">上传物业管理合同</p>
                                        <p class="text-xs text-gray-500 mt-1">支持 PDF 格式，最大10MB</p>
                                    </div>
                                    <input type="file" id="managementContract" name="managementContract" accept=".pdf" class="hidden" onchange="handleFileUpload(this, 'managementContractPreview')">
                                    <div id="managementContractPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                                </div>
                            </div>

                            <!-- 保险配置 -->
                            <div class="lg:col-span-2">
                                <h5 class="font-semibold text-gray-900 mb-3">保险配置</h5>
                                <div class="space-y-4">
                                    <!-- 火灾保险 -->
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <input type="checkbox" id="fireInsurance" name="insuranceTypes" value="fire" class="checkbox-custom" checked>
                                            <label for="fireInsurance" class="font-medium text-gray-900">火灾保险</label>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保险公司</label>
                                                <input type="text" name="fireInsuranceCompany" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：中国人保财险">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保额 (万元)</label>
                                                <input type="number" name="fireInsuranceAmount" min="0"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：50000">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">到期日期</label>
                                                <input type="date" name="fireInsuranceExpiry"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 地震保险 -->
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <input type="checkbox" id="earthquakeInsurance" name="insuranceTypes" value="earthquake" class="checkbox-custom">
                                            <label for="earthquakeInsurance" class="font-medium text-gray-900">地震保险</label>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保险公司</label>
                                                <input type="text" name="earthquakeInsuranceCompany" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：太平洋财险">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保额 (万元)</label>
                                                <input type="number" name="earthquakeInsuranceAmount" min="0"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：30000">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">到期日期</label>
                                                <input type="date" name="earthquakeInsuranceExpiry"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 综合责任保险 -->
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <input type="checkbox" id="liabilityInsurance" name="insuranceTypes" value="liability" class="checkbox-custom">
                                            <label for="liabilityInsurance" class="font-medium text-gray-900">综合责任保险</label>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保险公司</label>
                                                <input type="text" name="liabilityInsuranceCompany" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：平安财险">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">保额 (万元)</label>
                                                <input type="number" name="liabilityInsuranceAmount" min="0"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                       placeholder="例：5000">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">到期日期</label>
                                                <input type="date" name="liabilityInsuranceExpiry"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 保险单据上传 -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        保险单据
                                    </label>
                                    <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('insurancePolicies').click()">
                                        <i class="fas fa-shield-alt text-4xl text-gray-400 mb-3"></i>
                                        <p class="text-sm text-gray-600">上传保险单据</p>
                                        <p class="text-xs text-gray-500 mt-1">支持 PDF 格式，可上传多个文件</p>
                                    </div>
                                    <input type="file" id="insurancePolicies" name="insurancePolicies" accept=".pdf" multiple class="hidden" onchange="handleFileUpload(this, 'insurancePoliciesPreview')">
                                    <div id="insurancePoliciesPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                                </div>
                            </div>

                            <!-- 维护储备金 -->
                            <div class="lg:col-span-2">
                                <h5 class="font-semibold text-gray-900 mb-3">维护储备金账户</h5>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            托管银行 <span class="text-red-500">*</span>
                                        </label>
                                        <select id="custodyBank" name="custodyBank" required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                            <option value="">请选择托管银行</option>
                                            <option value="icbc">中国工商银行</option>
                                            <option value="ccb">中国建设银行</option>
                                            <option value="abc">中国农业银行</option>
                                            <option value="boc">中国银行</option>
                                            <option value="cmb">招商银行</option>
                                            <option value="citic">中信银行</option>
                                            <option value="other">其他银行</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            储备金余额 (万元) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" id="reserveFundBalance" name="reserveFundBalance" required min="0"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：500">
                                        <p class="text-xs text-gray-500 mt-1">建议为年运营费用的10-20%</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            年度维护预算 (万元)
                                        </label>
                                        <input type="number" id="annualMaintenanceBudget" name="annualMaintenanceBudget" min="0"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：200">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            账户监管方
                                        </label>
                                        <input type="text" id="accountSupervisor" name="accountSupervisor"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：第三方审计机构">
                                    </div>
                                </div>
                            </div>

                            <!-- IoT设备和监控 -->
                            <div class="lg:col-span-2">
                                <h5 class="font-semibold text-gray-900 mb-3">IoT设备和实时监控</h5>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="security_cameras" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">安防摄像头</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="access_control" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">门禁系统</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="fire_detection" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">火灾探测器</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="energy_monitoring" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">能耗监测</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="hvac_control" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">空调控制</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="elevator_monitoring" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">电梯监控</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="parking_sensors" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">停车传感器</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" name="iotDevices" value="water_leak_detection" class="checkbox-custom">
                                        <span class="text-sm text-gray-700">漏水检测</span>
                                    </label>
                                </div>

                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            IoT平台提供商
                                        </label>
                                        <input type="text" id="iotProvider" name="iotProvider"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                               placeholder="例：华为云IoT、阿里云IoT">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            数据更新频率
                                        </label>
                                        <select id="dataUpdateFrequency" name="dataUpdateFrequency"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                            <option value="">请选择更新频率</option>
                                            <option value="realtime">实时更新</option>
                                            <option value="5min">5分钟</option>
                                            <option value="15min">15分钟</option>
                                            <option value="hourly">每小时</option>
                                            <option value="daily">每日</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 托管风险提示 -->
                        <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mt-6">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-shield-alt text-yellow-600 mt-1"></i>
                                <div>
                                    <h5 class="font-semibold text-yellow-800 mb-2">托管安全要求</h5>
                                    <ul class="text-sm text-yellow-700 space-y-1">
                                        <li>• 物业管理公司必须具备相应资质且独立于资产所有方</li>
                                        <li>• 保险覆盖范围应包含主要风险并保持有效期内</li>
                                        <li>• 维护储备金应由第三方托管以确保资金安全</li>
                                        <li>• IoT设备数据需要通过预言机(Oracle)同步到区块链</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button type="button" onclick="prevStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-arrow-left mr-2"></i>上一步
                        </button>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-info-circle mr-1"></i>
                                可随时切换到其他步骤继续填写
                            </div>
                            <button type="button" onclick="nextStep()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                下一步：财务信息 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 步骤3: 财务信息（保持不变） -->
            <div id="step3" class="step-content hidden">
                <div class="form-section">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-yellow-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">财务信息</h3>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                资产估值 (万元) <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="assetValuation" name="assetValuation" required min="1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：50000">
                            <p class="text-xs text-gray-500 mt-1">最新专业评估机构出具的估值</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                评估机构
                            </label>
                            <input type="text" id="valuationFirm" name="valuationFirm"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：世邦魏理仕">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                评估日期 <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="valuationDate" name="valuationDate" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                购置成本 (万元)
                            </label>
                            <input type="number" id="acquisitionCost" name="acquisitionCost" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：45000">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                年租金收入 (万元) <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="annualRent" name="annualRent" required min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：3600">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                年运营成本 (万元)
                            </label>
                            <input type="number" id="operatingCost" name="operatingCost" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                当前出租率 (%)
                            </label>
                            <input type="number" id="occupancyRate" name="occupancyRate" min="0" max="100"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：95">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                预期年化收益率 (%)
                            </label>
                            <input type="number" id="expectedYield" name="expectedYield" min="0" max="100" step="0.1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：7.2" readonly>
                            <p class="text-xs text-gray-500 mt-1">自动计算：(年租金收入 - 年运营成本) / 资产估值 × 100%</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                贷款余额 (万元)
                            </label>
                            <input type="number" id="loanBalance" name="loanBalance" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：20000">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                贷款利率 (%)
                            </label>
                            <input type="number" id="loanRate" name="loanRate" min="0" max="100" step="0.01"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：3.85">
                        </div>

                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                财务备注
                            </label>
                            <textarea id="financialNotes" name="financialNotes" rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                      placeholder="例：资产估值基于DCF模型，考虑了未来10年现金流..."></textarea>
                        </div>
                    </div>

                    <!-- 市场分析数据 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">市场分析数据</h4>
                        <p class="text-sm text-gray-600 mb-4">提供周边市场数据以验证资产价值和投资潜力</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    当前市场租金率 (元/㎡/月) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="marketRentRate" name="marketRentRate" required min="0" step="0.1"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                       placeholder="例：85.5">
                                <p class="text-xs text-gray-500 mt-1">所在区域同类物业的平均租金水平</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    区域空置率 (%) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="vacancyRate" name="vacancyRate" required min="0" max="100" step="0.1"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                       placeholder="例：8.5">
                                <p class="text-xs text-gray-500 mt-1">同类型物业在该区域的空置率</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    数据来源机构
                                </label>
                                <select id="marketDataSource" name="marketDataSource"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                    <option value="">请选择数据来源</option>
                                    <option value="savills">第一太平戴维斯</option>
                                    <option value="cbre">世邦魏理仕</option>
                                    <option value="jll">仲量联行</option>
                                    <option value="centaline">中原地产</option>
                                    <option value="5i5j">我爱我家</option>
                                    <option value="lianjia">链家</option>
                                    <option value="other">其他权威机构</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    数据获取日期
                                </label>
                                <input type="date" id="marketDataDate" name="marketDataDate"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                            </div>
                        </div>

                        <!-- 可比物业数据 -->
                        <div class="mt-6">
                            <h5 class="font-semibold text-gray-900 mb-3">周边可比物业数据</h5>
                            <div id="comparableProperties" class="space-y-4">
                                <!-- 可比物业1 -->
                                <div class="comparable-property border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h6 class="font-medium text-gray-900">可比物业 #1</h6>
                                        <button type="button" onclick="removeComparableProperty(this)" class="text-red-500 hover:text-red-700 text-sm">
                                            <i class="fas fa-trash"></i> 删除
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">物业名称</label>
                                            <input type="text" name="comparablePropertyName[]" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：国贸中心">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">距离 (公里)</label>
                                            <input type="number" name="comparablePropertyDistance[]" min="0" step="0.1"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：1.2">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">租金率 (元/㎡/月)</label>
                                            <input type="number" name="comparablePropertyRent[]" min="0" step="0.1"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：90.0" onchange="calculateMarketAnalysis()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">建筑年份</label>
                                            <input type="number" name="comparablePropertyYear[]" min="1950" max="2024"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：2010">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">建筑等级</label>
                                            <select name="comparablePropertyGrade[]"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                                <option value="">选择等级</option>
                                                <option value="a">甲级</option>
                                                <option value="b">乙级</option>
                                                <option value="c">丙级</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">出租率 (%)</label>
                                            <input type="number" name="comparablePropertyOccupancy[]" min="0" max="100"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                                                   placeholder="例：95">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" onclick="addComparableProperty()" class="mt-3 px-4 py-2 border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-50">
                                <i class="fas fa-plus mr-2"></i>添加可比物业
                            </button>
                        </div>

                        <!-- 市场竞争力分析 -->
                        <div class="bg-green-50 p-4 rounded-lg mt-6">
                            <h5 class="font-semibold text-green-900 mb-3">市场竞争力分析</h5>
                            <div id="marketAnalysisResult" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-700" id="rentPremiumDisplay">-</div>
                                    <div class="text-xs text-green-600">租金溢价率</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-700" id="marketPositionDisplay">-</div>
                                    <div class="text-xs text-green-600">市场地位</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-700" id="vacancyComparisonDisplay">-</div>
                                    <div class="text-xs text-green-600">空置率对比</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-700" id="marketScoreDisplay">-</div>
                                    <div class="text-xs text-green-600">综合评分</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 实时收益计算 -->
                    <div class="bg-blue-50 p-4 rounded-lg mt-6">
                        <h4 class="font-semibold text-blue-900 mb-3">财务指标预览</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-700" id="capRateDisplay">-</div>
                                <div class="text-xs text-blue-600">资本化率</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-700" id="netYieldDisplay">-</div>
                                <div class="text-xs text-blue-600">净收益率</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-700" id="ltvRatioDisplay">-</div>
                                <div class="text-xs text-blue-600">贷款价值比</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-700" id="monthlyCashFlowDisplay">-</div>
                                <div class="text-xs text-blue-600">月净现金流</div>
                            </div>
                        </div>
                    </div>

                    <!-- 商业租赁协议 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">商业租赁协议</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- 主要租赁协议 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    主要租赁协议 <span class="text-red-500">*</span>
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('leaseAgreements').click()">
                                    <i class="fas fa-handshake text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传租赁协议</p>
                                    <p class="text-xs text-gray-500 mt-1">包括所有有效的租赁合同</p>
                                </div>
                                <input type="file" id="leaseAgreements" name="leaseAgreements" accept=".pdf" multiple class="hidden" onchange="handleFileUpload(this, 'leaseAgreementsPreview')">
                                <div id="leaseAgreementsPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>

                            <!-- 租金收入证明 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    租金收入证明
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('rentIncomeProof').click()">
                                    <i class="fas fa-receipt text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传租金收入证明</p>
                                    <p class="text-xs text-gray-500 mt-1">近12个月的租金收入记录</p>
                                </div>
                                <input type="file" id="rentIncomeProof" name="rentIncomeProof" accept=".pdf,.xlsx,.csv" multiple class="hidden" onchange="handleFileUpload(this, 'rentIncomeProofPreview')">
                                <div id="rentIncomeProofPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button type="button" onclick="prevStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-arrow-left mr-2"></i>上一步
                        </button>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-info-circle mr-1"></i>
                                可随时切换到其他步骤继续填写
                            </div>
                            <button type="button" onclick="nextStep()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                下一步：物理特征 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 步骤4: 物理特征（保持不变） -->
            <div id="step4" class="step-content hidden">
                <div class="form-section">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-building text-purple-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">物理特征</h3>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建成年份 <span class="text-red-500">*</span>
                            </label>
                            <input type="number" id="buildYear" name="buildYear" required min="1900" max="2024"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：2015">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建筑层数
                            </label>
                            <input type="number" id="floors" name="floors" min="1"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：45">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                电梯数量
                            </label>
                            <input type="number" id="elevators" name="elevators" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：12">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                停车位数量
                            </label>
                            <input type="number" id="parkingSpaces" name="parkingSpaces" min="0"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                   placeholder="例：500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建筑结构
                            </label>
                            <select id="structure" name="structure"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">请选择建筑结构</option>
                                <option value="concrete">钢筋混凝土</option>
                                <option value="steel">钢结构</option>
                                <option value="mixed">钢混结构</option>
                                <option value="other">其他</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                建筑等级
                            </label>
                            <select id="buildingGrade" name="buildingGrade"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">请选择建筑等级</option>
                                <option value="a">甲级</option>
                                <option value="b">乙级</option>
                                <option value="c">丙级</option>
                            </select>
                        </div>
                    </div>

                    <!-- 设施配套 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">设施配套</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="centralAC" class="checkbox-custom">
                                <span class="text-sm text-gray-700">中央空调</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="security" class="checkbox-custom">
                                <span class="text-sm text-gray-700">24小时保安</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="cafeteria" class="checkbox-custom">
                                <span class="text-sm text-gray-700">员工餐厅</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="gym" class="checkbox-custom">
                                <span class="text-sm text-gray-700">健身房</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="conference" class="checkbox-custom">
                                <span class="text-sm text-gray-700">会议中心</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="retail" class="checkbox-custom">
                                <span class="text-sm text-gray-700">商业配套</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="metro" class="checkbox-custom">
                                <span class="text-sm text-gray-700">地铁直达</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="facilities" value="generator" class="checkbox-custom">
                                <span class="text-sm text-gray-700">备用发电机</span>
                            </label>
                        </div>
                    </div>

                    <!-- 建筑照片上传 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">建筑照片 <span class="text-red-500">*</span></h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">外观照片</label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('exteriorPhotos').click()">
                                    <i class="fas fa-camera text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传建筑外观照片</p>
                                    <p class="text-xs text-gray-500 mt-1">支持 JPG, PNG 格式，最多5张</p>
                                </div>
                                <input type="file" id="exteriorPhotos" name="exteriorPhotos" accept=".jpg,.png" multiple class="hidden" onchange="handleFileUpload(this, 'exteriorPhotosPreview')">
                                <div id="exteriorPhotosPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">内部照片</label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('interiorPhotos').click()">
                                    <i class="fas fa-camera text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传内部空间照片</p>
                                    <p class="text-xs text-gray-500 mt-1">支持 JPG, PNG 格式，最多10张</p>
                                </div>
                                <input type="file" id="interiorPhotos" name="interiorPhotos" accept=".jpg,.png" multiple class="hidden" onchange="handleFileUpload(this, 'interiorPhotosPreview')">
                                <div id="interiorPhotosPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button type="button" onclick="prevStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-arrow-left mr-2"></i>上一步
                        </button>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-info-circle mr-1"></i>
                                可随时切换到其他步骤继续填写
                            </div>
                            <button type="button" onclick="nextStep()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                下一步：审核提交 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 步骤5: 审核提交（修改版，移除代币化设置） -->
            <div id="step5" class="step-content hidden">
                <div class="form-section">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-red-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900">审核提交</h3>
                    </div>

                    <!-- 风险评估和合规 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">风险评估和监管合规</h4>
                        <p class="text-sm text-gray-600 mb-4">完成风险评估和监管合规要求</p>
                        
                        <!-- 税务合规 -->
                        <div class="mb-6">
                            <h5 class="font-semibold text-gray-900 mb-3">税务合规</h5>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- 税务登记 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        税务登记证号
                                    </label>
                                    <input type="text" id="taxRegistrationNumber" name="taxRegistrationNumber"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                           placeholder="例：91310000XXXXXXXXXX">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        税务主管机关
                                    </label>
                                    <input type="text" id="taxAuthority" name="taxAuthority"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                           placeholder="例：上海市浦东新区税务局">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        适用税率类型
                                    </label>
                                    <select id="taxRateType" name="taxRateType"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择税率类型</option>
                                        <option value="corporate_standard">企业所得税(25%)</option>
                                        <option value="corporate_preferential">优惠税率(15%)</option>
                                        <option value="reit_special">REIT特殊税制</option>
                                        <option value="offshore">离岸税制</option>
                                        <option value="other">其他</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        年度税务申报状态
                                    </label>
                                    <select id="taxFilingStatus" name="taxFilingStatus"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择申报状态</option>
                                        <option value="current">已完成当年申报</option>
                                        <option value="in_progress">申报进行中</option>
                                        <option value="pending">等待申报</option>
                                        <option value="exempt">免税实体</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- 税务文件上传 -->
                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    税务文件
                                </label>
                                <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('taxDocuments').click()">
                                    <i class="fas fa-calculator text-4xl text-gray-400 mb-3"></i>
                                    <p class="text-sm text-gray-600">上传税务相关文件</p>
                                    <p class="text-xs text-gray-500 mt-1">包括税务登记证、纳税申报表等</p>
                                </div>
                                <input type="file" id="taxDocuments" name="taxDocuments" accept=".pdf" multiple class="hidden" onchange="handleFileUpload(this, 'taxDocumentsPreview')">
                                <div id="taxDocumentsPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>

                        <!-- 地缘政治风险评估 -->
                        <div class="mb-6">
                            <h5 class="font-semibold text-gray-900 mb-3">地缘政治风险评估</h5>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        政治稳定性评级
                                    </label>
                                    <select id="politicalStability" name="politicalStability"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择评级</option>
                                        <option value="aaa">AAA - 极其稳定</option>
                                        <option value="aa">AA - 非常稳定</option>
                                        <option value="a">A - 稳定</option>
                                        <option value="bbb">BBB - 中等稳定</option>
                                        <option value="bb">BB - 轻微不稳定</option>
                                        <option value="b">B - 不稳定</option>
                                        <option value="c">C - 高度不稳定</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        法律环境评级
                                    </label>
                                    <select id="legalEnvironment" name="legalEnvironment"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择评级</option>
                                        <option value="excellent">优秀 - 健全法治</option>
                                        <option value="good">良好 - 稳定法治</option>
                                        <option value="fair">一般 - 基本法治</option>
                                        <option value="poor">较差 - 法治不完善</option>
                                        <option value="very_poor">很差 - 缺乏法治</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        经济政策风险
                                    </label>
                                    <select id="economicPolicy" name="economicPolicy"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择风险级别</option>
                                        <option value="low">低风险</option>
                                        <option value="moderate">中等风险</option>
                                        <option value="high">高风险</option>
                                        <option value="extreme">极高风险</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        汇率波动风险
                                    </label>
                                    <select id="currencyRisk" name="currencyRisk"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                        <option value="">请选择风险级别</option>
                                        <option value="low">低风险 (<5%年波动)</option>
                                        <option value="moderate">中等风险 (5-15%年波动)</option>
                                        <option value="high">高风险 (15-30%年波动)</option>
                                        <option value="extreme">极高风险 (>30%年波动)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 数据保护合规 -->
                        <div class="mb-6">
                            <h5 class="font-semibold text-gray-900 mb-3">数据保护合规</h5>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            适用的数据保护法规
                                        </label>
                                        <div class="space-y-2">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="dataProtectionLaws" value="gdpr" class="checkbox-custom">
                                                <span class="text-sm text-gray-700">GDPR (欧盟通用数据保护条例)</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="dataProtectionLaws" value="ccpa" class="checkbox-custom">
                                                <span class="text-sm text-gray-700">CCPA (加州消费者隐私法)</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="dataProtectionLaws" value="pipl" class="checkbox-custom">
                                                <span class="text-sm text-gray-700">PIPL (中国个人信息保护法)</span>
                                            </label>
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" name="dataProtectionLaws" value="pdpa" class="checkbox-custom">
                                                <span class="text-sm text-gray-700">PDPA (新加坡个人数据保护法)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            跨境数据传输合规
                                        </label>
                                        <select id="crossBorderData" name="crossBorderData"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus">
                                            <option value="">请选择合规状态</option>
                                            <option value="domestic_only">仅境内存储</option>
                                            <option value="adequacy_decision">充分性决定</option>
                                            <option value="scc">标准合同条款</option>
                                            <option value="bcr">约束性公司规则</option>
                                            <option value="certification">认证机制</option>
                                            <option value="derogation">特定情形豁免</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        数据处理合法性基础
                                    </label>
                                    <textarea id="dataProcessingBasis" name="dataProcessingBasis" rows="3"
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus"
                                              placeholder="描述数据处理的合法性基础，如用户同意、合同履行、合法权益等..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 风险评估报告 -->
                        <div class="mb-6">
                            <h5 class="font-semibold text-gray-900 mb-3">风险评估报告</h5>
                            <div class="upload-area text-center p-6 rounded-lg cursor-pointer" onclick="document.getElementById('riskAssessmentReport').click()">
                                <i class="fas fa-exclamation-triangle text-4xl text-gray-400 mb-3"></i>
                                <p class="text-sm text-gray-600">上传风险评估报告</p>
                                <p class="text-xs text-gray-500 mt-1">由第三方机构出具的综合风险评估</p>
                            </div>
                            <input type="file" id="riskAssessmentReport" name="riskAssessmentReport" accept=".pdf" class="hidden" onchange="handleFileUpload(this, 'riskAssessmentReportPreview')">
                            <div id="riskAssessmentReportPreview" class="file-preview mt-2 p-3 rounded-lg hidden"></div>
                        </div>

                        <!-- 综合风险评分 -->
                        <div class="bg-gradient-to-r from-yellow-50 to-red-50 p-6 rounded-lg">
                            <h5 class="font-semibold text-gray-900 mb-4">综合风险评分</h5>
                            <div id="riskScoreDisplay" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-yellow-700" id="overallRiskScore">-</div>
                                    <div class="text-xs text-yellow-600">总体风险</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-red-700" id="politicalRisk">-</div>
                                    <div class="text-xs text-red-600">政治风险</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-orange-700" id="legalRisk">-</div>
                                    <div class="text-xs text-orange-600">法律风险</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-purple-700" id="complianceRisk">-</div>
                                    <div class="text-xs text-purple-600">合规风险</div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>风险等级：</span>
                                    <span id="riskLevel" class="font-medium">待评估</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div id="riskProgressBar" class="h-3 rounded-full bg-gradient-to-r from-green-500 to-red-500" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 信息确认 -->
                    <div class="preview-card p-6 rounded-lg mb-6">
                        <h4 class="font-semibold text-gray-900 mb-4">资产信息确认</h4>
                        <div id="assetSummary" class="space-y-3">
                            <!-- 这里将通过JavaScript动态填充资产信息 -->
                        </div>
                    </div>

                    <!-- 合规声明 -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-gray-900">合规声明与确认</h4>
                        
                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" id="legalCompliance" name="legalCompliance" required class="checkbox-custom mt-1">
                            <span class="text-sm text-gray-700">
                                我确认所提供的所有资产信息和法律文件均真实有效，符合当地法律法规要求。
                            </span>
                        </label>

                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" id="assetOwnership" name="assetOwnership" required class="checkbox-custom mt-1">
                            <span class="text-sm text-gray-700">
                                我确认对该资产拥有完整的所有权，不存在任何产权纠纷或法律争议。
                            </span>
                        </label>

                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" id="platformAgreement" name="platformAgreement" required class="checkbox-custom mt-1">
                            <span class="text-sm text-gray-700">
                                我同意PropertyChain平台的<a href="#" class="text-blue-600 underline">服务条款</a>和<a href="#" class="text-blue-600 underline">隐私政策</a>。
                            </span>
                        </label>

                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" id="auditPermission" name="auditPermission" required class="checkbox-custom mt-1">
                            <span class="text-sm text-gray-700">
                                我授权平台及其合作的第三方机构对资产进行尽职调查和审计。
                            </span>
                        </label>
                    </div>

                    <!-- 预计审核流程 -->
                    <div class="bg-blue-50 p-6 rounded-lg mt-6">
                        <h4 class="font-semibold text-blue-900 mb-4">预计审核流程</h4>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs font-bold">1</div>
                                <span class="text-sm text-blue-800">初步审核 (1-2个工作日)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-white text-xs font-bold">2</div>
                                <span class="text-sm text-gray-600">法律合规检查 (3-5个工作日)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-white text-xs font-bold">3</div>
                                <span class="text-sm text-gray-600">第三方资产评估 (5-7个工作日)</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-white text-xs font-bold">4</div>
                                <span class="text-sm text-gray-600">审核完成，资产上架 (1个工作日)</span>
                            </div>
                        </div>
                        <p class="text-sm text-blue-700 mt-4">
                            <i class="fas fa-info-circle mr-1"></i>
                            预计总审核时间：10-15个工作日
                        </p>
                        <p class="text-sm text-blue-600 mt-2">
                            审核通过后，您可以在<strong>代币化管理</strong>页面对资产进行代币化设置
                        </p>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button type="button" onclick="prevStep()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-arrow-left mr-2"></i>上一步
                        </button>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-info-circle mr-1"></i>
                                可返回之前步骤修改信息
                            </div>
                            <button type="submit" class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                                <i class="fas fa-paper-plane mr-2"></i>提交审核
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- 保存草稿模态框 -->
    <div id="draftModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 m-6 max-w-md w-full">
            <div class="flex items-center space-x-3 mb-4">
                <i class="fas fa-save text-green-600 text-xl"></i>
                <h3 class="text-lg font-semibold text-gray-900">保存草稿</h3>
            </div>
            <p class="text-gray-600 mb-6">草稿已自动保存，您可以随时返回继续编辑。</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeDraftModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800">
                    关闭
                </button>
                <button onclick="continueLater()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    稍后继续
                </button>
            </div>
        </div>
    </div>

    <!-- 预览模态框 -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg m-6 max-w-4xl w-full max-h-screen overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-gray-900">资产预览</h3>
                    <button onclick="closePreviewModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div id="previewContent" class="p-6">
                <!-- 预览内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        // 步骤导航 - 支持自由跳转
        function goToStep(step) {
            if (step >= 1 && step <= totalSteps) {
                hideStep(currentStep);
                currentStep = step;
                showStep(currentStep);
                updateProgress();
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                goToStep(currentStep + 1);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }

        function showStep(step) {
            // 隐藏所有步骤
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`step${i}`).classList.add('hidden');
            }
            
            // 显示当前步骤
            document.getElementById(`step${step}`).classList.remove('hidden');
            document.getElementById('currentStep').textContent = step;
            
            // 更新步骤指示器
            const stepNavs = document.querySelectorAll('.step-nav');
            stepNavs.forEach((el, index) => {
                if (index + 1 < step) {
                    el.className = 'step-nav step-completed flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform';
                } else if (index + 1 === step) {
                    el.className = 'step-nav step-active flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform';
                } else {
                    el.className = 'step-nav step-pending flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold cursor-pointer hover:scale-110 transition-transform';
                }
            });
        }

        function hideStep(step) {
            document.getElementById(`step${step}`).classList.add('hidden');
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // 步骤预览切换
        function toggleStepPreview() {
            const preview = document.getElementById('stepPreview');
            if (preview.classList.contains('hidden')) {
                preview.classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
            }
        }

        // 主图上传处理
        function handleMainPhotoUpload(input) {
            const preview = document.getElementById('mainPhotoPreview');
            const display = document.getElementById('mainPhotoDisplay');
            const file = input.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    display.innerHTML = `
                        <div class="relative">
                            <img src="${e.target.result}" alt="资产主图" class="w-full h-48 object-cover rounded-lg">
                            <div class="absolute top-2 right-2 bg-green-600 text-white px-2 py-1 rounded-full text-xs font-medium">
                                <i class="fas fa-star mr-1"></i>主图
                            </div>
                            <button type="button" onclick="removeMainPhoto()" class="absolute top-2 left-2 bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center hover:bg-red-700">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                            <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2 rounded-b-lg">
                                <p class="text-sm font-medium">${file.name}</p>
                                <p class="text-xs opacity-75">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                            </div>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
                preview.classList.remove('hidden');
            }
        }

        function removeMainPhoto() {
            document.getElementById('mainPhoto').value = '';
            document.getElementById('mainPhotoPreview').classList.add('hidden');
        }

        // 相册上传处理
        function handleGalleryUpload(input) {
            const preview = document.getElementById('assetGalleryPreview');
            const files = input.files;

            if (files.length > 0) {
                let galleryHTML = '<div class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                
                for (let i = 0; i < Math.min(files.length, 10); i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'relative';
                        imageDiv.innerHTML = `
                            <img src="${e.target.result}" alt="资产照片${i+1}" class="w-full h-32 object-cover rounded-lg">
                            <button type="button" onclick="removeGalleryImage(this)" class="absolute top-1 right-1 bg-red-600 text-white w-5 h-5 rounded-full flex items-center justify-center hover:bg-red-700">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                            <div class="absolute bottom-1 left-1 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs">
                                ${i + 1}
                            </div>
                        `;
                        
                        if (i === 0) {
                            galleryHTML = '<div class="grid grid-cols-2 md:grid-cols-3 gap-3">';
                        }
                        
                        const container = preview.querySelector('.grid') || (() => {
                            preview.innerHTML = galleryHTML;
                            return preview.querySelector('.grid');
                        })();
                        
                        container.appendChild(imageDiv);
                        
                        if (i === files.length - 1 || i === 9) {
                            galleryHTML += '</div>';
                            if (files.length > 10) {
                                const warning = document.createElement('p');
                                warning.className = 'text-sm text-yellow-600 mt-2';
                                warning.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i>最多只能上传10张照片，已自动选择前10张';
                                preview.appendChild(warning);
                            }
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            }
        }

        function removeGalleryImage(button) {
            const imageDiv = button.closest('.relative');
            imageDiv.remove();
            
            // 重新编号剩余图片
            const images = document.querySelectorAll('#assetGalleryPreview .relative');
            images.forEach((img, index) => {
                const numberLabel = img.querySelector('.absolute.bottom-1');
                if (numberLabel) {
                    numberLabel.textContent = index + 1;
                }
            });
        }

        // 文件上传处理
        function handleFileUpload(input, previewId) {
            const preview = document.getElementById(previewId);
            const files = input.files;

            if (files.length > 0) {
                preview.innerHTML = '';
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileElement = document.createElement('div');
                    fileElement.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-lg mb-2';
                    fileElement.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-file-${file.type.includes('pdf') ? 'pdf text-red-500' : 'image text-blue-500'}"></i>
                            <span class="text-sm text-gray-700">${file.name}</span>
                            <span class="text-xs text-gray-500">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                        </div>
                        <button type="button" onclick="removeFile(this)" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    preview.appendChild(fileElement);
                }
                preview.classList.remove('hidden');
            }
        }

        function removeFile(button) {
            const fileDiv = button.closest('div').parentElement;
            fileDiv.remove();
        }

        // 财务计算
        function calculateFinancials() {
            const valuation = parseFloat(document.getElementById('assetValuation').value) || 0;
            const annualRent = parseFloat(document.getElementById('annualRent').value) || 0;
            const operatingCost = parseFloat(document.getElementById('operatingCost').value) || 0;
            const loanBalance = parseFloat(document.getElementById('loanBalance').value) || 0;

            // 计算收益率
            const netIncome = annualRent - operatingCost;
            const capRate = valuation > 0 ? (annualRent / (valuation * 10000) * 100).toFixed(2) : 0;
            const netYield = valuation > 0 ? (netIncome / (valuation * 10000) * 100).toFixed(2) : 0;
            const ltvRatio = valuation > 0 ? (loanBalance / valuation * 100).toFixed(2) : 0;
            const monthlyCashFlow = ((netIncome * 10000) / 12).toFixed(0);

            // 更新显示
            document.getElementById('capRateDisplay').textContent = capRate + '%';
            document.getElementById('netYieldDisplay').textContent = netYield + '%';
            document.getElementById('ltvRatioDisplay').textContent = ltvRatio + '%';
            document.getElementById('monthlyCashFlowDisplay').textContent = '¥' + monthlyCashFlow;
            document.getElementById('expectedYield').value = netYield;
        }

        // 添加可比物业
        function addComparableProperty() {
            const container = document.getElementById('comparableProperties');
            const count = container.children.length + 1;
            
            const propertyDiv = document.createElement('div');
            propertyDiv.className = 'comparable-property border border-gray-200 rounded-lg p-4';
            propertyDiv.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h6 class="font-medium text-gray-900">可比物业 #${count}</h6>
                    <button type="button" onclick="removeComparableProperty(this)" class="text-red-500 hover:text-red-700 text-sm">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">物业名称</label>
                        <input type="text" name="comparablePropertyName[]" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：国贸中心">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">距离 (公里)</label>
                        <input type="number" name="comparablePropertyDistance[]" min="0" step="0.1"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：1.2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">租金率 (元/㎡/月)</label>
                        <input type="number" name="comparablePropertyRent[]" min="0" step="0.1"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：90.0" onchange="calculateMarketAnalysis()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">建筑年份</label>
                        <input type="number" name="comparablePropertyYear[]" min="1950" max="2024"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：2010">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">建筑等级</label>
                        <select name="comparablePropertyGrade[]"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                            <option value="">选择等级</option>
                            <option value="a">甲级</option>
                            <option value="b">乙级</option>
                            <option value="c">丙级</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">出租率 (%)</label>
                        <input type="number" name="comparablePropertyOccupancy[]" min="0" max="100"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：95">
                    </div>
                </div>
            `;
            
            container.appendChild(propertyDiv);
        }

        function removeComparableProperty(button) {
            const propertyDiv = button.closest('.comparable-property');
            propertyDiv.remove();
            
            // 重新编号
            const properties = document.querySelectorAll('.comparable-property');
            properties.forEach((prop, index) => {
                const title = prop.querySelector('h6');
                title.textContent = `可比物业 #${index + 1}`;
            });
            
            calculateMarketAnalysis();
        }

        // 市场分析计算
        function calculateMarketAnalysis() {
            const buildingArea = parseFloat(document.getElementById('buildingArea').value) || 0;
            const annualRent = parseFloat(document.getElementById('annualRent').value) || 0;
            const marketRentRate = parseFloat(document.getElementById('marketRentRate').value) || 0;
            const vacancyRate = parseFloat(document.getElementById('vacancyRate').value) || 0;
            const occupancyRate = parseFloat(document.getElementById('occupancyRate').value) || 0;

            // 计算当前资产的月租金率
            const currentRentRate = buildingArea > 0 ? (annualRent * 10000 / 12 / buildingArea) : 0;
            
            // 计算租金溢价率
            const rentPremium = marketRentRate > 0 ? ((currentRentRate - marketRentRate) / marketRentRate * 100).toFixed(1) : 0;
            
            // 获取可比物业数据
            const comparableRents = Array.from(document.querySelectorAll('input[name="comparablePropertyRent[]"]'))
                .map(input => parseFloat(input.value) || 0)
                .filter(rent => rent > 0);
            
            let marketPosition = '-';
            let vacancyComparison = '-';
            let marketScore = '-';
            
            if (comparableRents.length > 0) {
                const avgComparableRent = comparableRents.reduce((a, b) => a + b, 0) / comparableRents.length;
                const betterThanCount = comparableRents.filter(rent => currentRentRate > rent).length;
                marketPosition = `${Math.round(betterThanCount / comparableRents.length * 100)}%`;
                
                // 空置率比较
                if (vacancyRate > 0 && occupancyRate > 0) {
                    const currentVacancy = 100 - occupancyRate;
                    vacancyComparison = currentVacancy < vacancyRate ? '优于市场' : '低于市场';
                }
                
                // 综合评分 (0-100)
                const rentScore = Math.min(100, Math.max(0, (currentRentRate / avgComparableRent) * 50));
                const occupancyScore = Math.min(50, occupancyRate || 0);
                marketScore = Math.round(rentScore + occupancyScore);
            }

            // 更新显示
            document.getElementById('rentPremiumDisplay').textContent = rentPremium + '%';
            document.getElementById('marketPositionDisplay').textContent = marketPosition;
            document.getElementById('vacancyComparisonDisplay').textContent = vacancyComparison;
            document.getElementById('marketScoreDisplay').textContent = marketScore;
        }

        // 添加股东
        function addShareholder() {
            const container = document.getElementById('shareholdersList');
            const count = container.children.length + 1;
            
            const shareholderDiv = document.createElement('div');
            shareholderDiv.className = 'shareholder-info border border-gray-200 rounded-lg p-4';
            shareholderDiv.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h6 class="font-medium text-gray-900">股东 #${count}</h6>
                    <button type="button" onclick="removeShareholder(this)" class="text-red-500 hover:text-red-700 text-sm">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">股东名称/姓名</label>
                        <input type="text" name="shareholderName[]" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：万科企业股份有限公司">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">股东类型</label>
                        <select name="shareholderType[]" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                            <option value="corporate">企业法人</option>
                            <option value="individual">自然人</option>
                            <option value="institution">机构投资者</option>
                            <option value="fund">基金</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">持股比例 (%)</label>
                        <input type="number" name="shareholderPercentage[]" min="0" max="100" step="0.01" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：100.00" onchange="calculateTotalShares()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">投票权比例 (%)</label>
                        <input type="number" name="votingRights[]" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus"
                               placeholder="例：100.00">
                    </div>
                </div>
            `;
            
            container.appendChild(shareholderDiv);
        }

        function removeShareholder(button) {
            const shareholderDiv = button.closest('.shareholder-info');
            shareholderDiv.remove();
            
            // 重新编号
            const shareholders = document.querySelectorAll('.shareholder-info');
            shareholders.forEach((shareholder, index) => {
                const title = shareholder.querySelector('h6');
                title.textContent = `股东 #${index + 1}`;
            });
            
            calculateTotalShares();
        }

        // 计算总持股比例
        function calculateTotalShares() {
            const shareInputs = document.querySelectorAll('input[name="shareholderPercentage[]"]');
            let total = 0;
            
            shareInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            
            const totalElement = document.getElementById('totalShares');
            const validationElement = document.getElementById('sharesValidation');
            
            totalElement.textContent = total.toFixed(2) + '%';
            
            if (total === 100) {
                totalElement.className = 'text-lg font-bold text-green-700';
                validationElement.textContent = '持股比例正确 ✓';
                validationElement.className = 'text-xs text-green-600 mt-1';
            } else if (total > 100) {
                totalElement.className = 'text-lg font-bold text-red-700';
                validationElement.textContent = '持股比例超过100%，请调整';
                validationElement.className = 'text-xs text-red-600 mt-1';
            } else {
                totalElement.className = 'text-lg font-bold text-yellow-700';
                validationElement.textContent = '持股比例不足100%，请补充';
                validationElement.className = 'text-xs text-yellow-600 mt-1';
            }
        }

        // 计算风险评分
        function calculateRiskScore() {
            const politicalStability = document.getElementById('politicalStability').value;
            const legalEnvironment = document.getElementById('legalEnvironment').value;
            const economicPolicy = document.getElementById('economicPolicy').value;
            const currencyRisk = document.getElementById('currencyRisk').value;
            const crossBorderData = document.getElementById('crossBorderData').value;
            
            // 政治风险评分 (0-100)
            const politicalScores = {
                'aaa': 10, 'aa': 20, 'a': 30, 'bbb': 50, 'bb': 70, 'b': 85, 'c': 100
            };
            
            // 法律风险评分 (0-100)
            const legalScores = {
                'excellent': 10, 'good': 25, 'fair': 50, 'poor': 75, 'very_poor': 100
            };
            
            // 经济政策风险评分 (0-100)
            const economicScores = {
                'low': 15, 'moderate': 40, 'high': 70, 'extreme': 100
            };
            
            // 汇率风险评分 (0-100)
            const currencyScores = {
                'low': 10, 'moderate': 35, 'high': 65, 'extreme': 100
            };
            
            // 合规风险评分 (0-100)
            const complianceScores = {
                'domestic_only': 20, 'adequacy_decision': 25, 'scc': 35, 'bcr': 30, 'certification': 40, 'derogation': 60
            };
            
            const politicalRisk = politicalScores[politicalStability] || 50;
            const legalRisk = legalScores[legalEnvironment] || 50;
            const economicRisk = economicScores[economicPolicy] || 50;
            const currencyRiskScore = currencyScores[currencyRisk] || 50;
            const complianceRisk = complianceScores[crossBorderData] || 50;
            
            // 综合风险评分 (加权平均)
            const overallRisk = Math.max(0, Math.min(100, 
                (politicalRisk * 0.25 + legalRisk * 0.25 + economicRisk * 0.2 + 
                 currencyRiskScore * 0.15 + complianceRisk * 0.15)
            ));
            
            // 更新显示
            document.getElementById('overallRiskScore').textContent = Math.round(overallRisk);
            document.getElementById('politicalRisk').textContent = politicalRisk;
            document.getElementById('legalRisk').textContent = legalRisk;
            document.getElementById('complianceRisk').textContent = complianceRisk;
            
            // 风险等级
            let riskLevel = '';
            let riskColor = '';
            if (overallRisk <= 25) {
                riskLevel = '低风险';
                riskColor = 'text-green-600';
            } else if (overallRisk <= 50) {
                riskLevel = '中低风险';
                riskColor = 'text-yellow-600';
            } else if (overallRisk <= 75) {
                riskLevel = '中高风险';
                riskColor = 'text-orange-600';
            } else {
                riskLevel = '高风险';
                riskColor = 'text-red-600';
            }
            
            const riskLevelElement = document.getElementById('riskLevel');
            riskLevelElement.textContent = riskLevel;
            riskLevelElement.className = `font-medium ${riskColor}`;
            
            // 更新进度条
            const progressBar = document.getElementById('riskProgressBar');
            progressBar.style.width = `${overallRisk}%`;
        }

        // 表单验证
        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let emptyFields = [];

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-yellow-300', 'bg-yellow-50');
                    emptyFields.push(field.previousElementSibling?.textContent || '某个字段');
                } else {
                    field.classList.remove('border-yellow-300', 'bg-yellow-50');
                    field.classList.add('validation-success');
                }
            });

            if (emptyFields.length > 0 && currentStep === totalSteps) {
                alert(`以下必填字段尚未填写：\n${emptyFields.join('\n')}\n\n请完善后再提交。`);
                return false;
            }

            return true;
        }

        // 保存草稿
        function saveDraft() {
            const formData = new FormData(document.getElementById('assetForm'));
            const draftData = {};
            
            for (let [key, value] of formData.entries()) {
                draftData[key] = value;
            }
            
            localStorage.setItem('assetDraft', JSON.stringify(draftData));
            document.getElementById('draftModal').classList.remove('hidden');
            document.getElementById('draftModal').classList.add('flex');
        }

        function closeDraftModal() {
            document.getElementById('draftModal').classList.add('hidden');
            document.getElementById('draftModal').classList.remove('flex');
        }

        function continueLater() {
            closeDraftModal();
            window.location.href = 'asset-list.html';
        }

        // 预览资产
        function previewAsset() {
            const previewContent = generatePreviewContent();
            document.getElementById('previewContent').innerHTML = previewContent;
            document.getElementById('previewModal').classList.remove('hidden');
            document.getElementById('previewModal').classList.add('flex');
        }

        function closePreviewModal() {
            document.getElementById('previewModal').classList.add('hidden');
            document.getElementById('previewModal').classList.remove('flex');
        }

        function generatePreviewContent() {
            const assetName = document.getElementById('assetName').value || '未填写';
            const assetType = document.getElementById('assetType').value || '未选择';
            const assetAddress = document.getElementById('assetAddress').value || '未填写';
            const buildingArea = document.getElementById('buildingArea').value || '0';
            const assetValuation = document.getElementById('assetValuation').value || '0';
            const expectedYield = document.getElementById('expectedYield').value || '0';

            const mainPhoto = document.querySelector('#mainPhotoDisplay img');
            const mainPhotoSrc = mainPhoto ? mainPhoto.src : 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=100&h=100&fit=crop';

            return `
                <div class="space-y-6">
                    <div class="flex items-center space-x-4">
                        <img src="${mainPhotoSrc}" 
                             alt="资产图片" class="w-20 h-20 rounded-lg object-cover">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">${assetName}</h3>
                            <p class="text-gray-600">${assetAddress}</p>
                            <div class="flex space-x-2 mt-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${assetType}</span>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">待审核</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-bold text-gray-900">${buildingArea}㎡</div>
                            <div class="text-sm text-gray-600">建筑面积</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-bold text-gray-900">¥${assetValuation}万</div>
                            <div class="text-sm text-gray-600">资产估值</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-bold text-gray-900">${expectedYield}%</div>
                            <div class="text-sm text-gray-600">预期收益率</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-bold text-gray-900">10-15天</div>
                            <div class="text-sm text-gray-600">预计审核时间</div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-900 mb-2">后续流程</h4>
                        <div class="text-sm text-blue-800">
                            <p>1. 提交审核后，平台将在1-2个工作日内开始初步审核</p>
                            <p>2. 审核通过后，资产将出现在"代币化管理"的"待代币化资产"列表中</p>
                            <p>3. 您可以选择合适的时机对资产进行代币化设置并发行</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成资产摘要
        function generateAssetSummary() {
            const summary = document.getElementById('assetSummary');
            const assetName = document.getElementById('assetName').value || '未填写';
            const assetType = document.getElementById('assetType').value || '未选择';
            const assetValuation = document.getElementById('assetValuation').value || '0';
            const buildingArea = document.getElementById('buildingArea').value || '0';
            const expectedYield = document.getElementById('expectedYield').value || '0';

            summary.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div><span class="font-medium">资产名称：</span>${assetName}</div>
                    <div><span class="font-medium">资产类型：</span>${assetType}</div>
                    <div><span class="font-medium">资产估值：</span>¥${assetValuation}万</div>
                    <div><span class="font-medium">建筑面积：</span>${buildingArea}㎡</div>
                    <div><span class="font-medium">预期收益率：</span>${expectedYield}%</div>
                    <div><span class="font-medium">预计审核时间：</span>10-15个工作日</div>
                </div>
            `;
        }

        // 监听字段变化
        ['marketRentRate', 'vacancyRate', 'buildingArea', 'annualRent', 'occupancyRate'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', calculateMarketAnalysis);
            }
        });

        ['assetValuation', 'annualRent', 'operatingCost', 'loanBalance'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', calculateFinancials);
            }
        });

        ['politicalStability', 'legalEnvironment', 'economicPolicy', 'currencyRisk', 'crossBorderData'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', calculateRiskScore);
            }
        });

        // 表单提交
        document.getElementById('assetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateCurrentStep()) {
                alert('资产信息已提交审核！\n\n我们将在1-2个工作日内开始初步审核，并通过邮件或站内消息通知您审核进度。\n\n审核通过后，您可以在"代币化管理"页面对该资产进行代币化设置。');
                window.location.href = 'asset-list.html';
            }
        });

        // 页面加载时的初始化
        document.addEventListener('DOMContentLoaded', function() {
            const savedDraft = localStorage.getItem('assetDraft');
            if (savedDraft) {
                const draftData = JSON.parse(savedDraft);
                console.log('Found saved draft:', draftData);
            }

            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.target.id === 'step5' && !mutation.target.classList.contains('hidden')) {
                        generateAssetSummary();
                    }
                });
            });

            const step5 = document.getElementById('step5');
            if (step5) {
                observer.observe(step5, { attributes: true, attributeFilter: ['class'] });
            }
        });

        // 拖拽上传功能
        document.querySelectorAll('.upload-area').forEach(area => {
            area.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            area.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            area.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                const inputId = this.getAttribute('onclick').match(/getElementById\('([^']+)'\)/)[1];
                const input = document.getElementById(inputId);
                
                if (input) {
                    input.files = files;
                    
                    if (inputId === 'mainPhoto') {
                        handleMainPhotoUpload(input);
                    } else if (inputId === 'assetGallery') {
                        handleGalleryUpload(input);
                    } else {
                        const previewId = inputId + 'Preview';
                        handleFileUpload(input, previewId);
                    }
                }
            });
        });
    </script>
</body>
</html>